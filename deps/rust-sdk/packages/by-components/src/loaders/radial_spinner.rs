#![allow(non_snake_case)]
use dioxus::prelude::*;

#[cfg(feature = "web")]
async fn sleep(ms: u32) {
    let promise = web_sys::js_sys::Promise::new(&mut |resolve, _| {
        web_sys::window()
            .unwrap()
            .set_timeout_with_callback_and_timeout_and_arguments_0(&resolve, ms as i32)
            .unwrap();
    });
    wasm_bindgen_futures::JsFuture::from(promise).await.unwrap();
}

#[component]
pub fn RadialSpinner(#[props(default = 60)] size: i32) -> Element {
    #[allow(unused_mut)]
    let mut ops = use_signal(|| vec![0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.0]);

    #[cfg(feature = "web")]
    let _ = use_coroutine(move |_rx: UnboundedReceiver<Vec<f64>>| async move {
        loop {
            sleep(100).await;
            let mut values = ops().clone();
            values.rotate_right(1);
            ops.set(values);
        }
    });

    rsx! {
        svg {
            fill: "none",
            height: "{size}",
            view_box: "0 0 60 60",
            width: "{size}",
            xmlns: "http://www.w3.org/2000/svg",
            g { clip_path: "url(#clip0_204_7856)",
                g { opacity: "{ops()[10]}",
                    path {
                        d: "M29.9999 14.2574C31.9684 14.2574 33.5643 11.0658 33.5643 7.12871C33.5643 3.19163 31.9684 0 29.9999 0C28.0314 0 26.4355 3.19163 26.4355 7.12871C26.4355 11.0658 28.0314 14.2574 29.9999 14.2574Z",
                        fill: "#85E3CB",
                    }
                }
                path {
                    d: "M22.0625 16.3992C23.7611 15.4042 23.5249 11.8437 21.535 8.44649C19.545 5.04932 16.5549 3.10194 14.8563 4.0969C13.1577 5.09186 13.3939 8.65239 15.3838 12.0496C17.3738 15.4467 20.3639 17.3941 22.0625 16.3992Z",
                    fill: "#85E3CB",
                }
                g { opacity: "{ops()[9]}",
                    path {
                        d: "M16.4065 22.0525C17.4015 20.3539 15.4541 17.3637 12.0569 15.3738C8.65976 13.3839 5.09923 13.1477 4.10427 14.8463C3.10931 16.5449 5.05669 19.535 8.45386 21.525C11.851 23.5149 15.4116 23.751 16.4065 22.0525Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[8]}",
                    path {
                        d: "M7.12871 33.5662C11.0658 33.5662 14.2574 31.9704 14.2574 30.0019C14.2574 28.0333 11.0658 26.4375 7.12871 26.4375C3.19163 26.4375 0 28.0333 0 30.0019C0 31.9704 3.19163 33.5662 7.12871 33.5662Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[7]}",
                    path {
                        d: "M12.0535 44.6106C15.4507 42.6206 17.3981 39.6305 16.4031 37.9319C15.4082 36.2333 11.8476 36.4695 8.45045 38.4594C5.05327 40.4493 3.10589 43.4395 4.10085 45.1381C5.09582 46.8367 8.65635 46.6005 12.0535 44.6106Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[6]}",
                    path {
                        d: "M21.533 51.5457C23.5229 48.1485 23.7591 44.588 22.0605 43.593C20.3619 42.5981 17.3718 44.5454 15.3819 47.9426C13.392 51.3398 13.1558 54.9003 14.8544 55.8953C16.553 56.8902 19.5431 54.9429 21.533 51.5457Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[5]}",
                    path {
                        d: "M29.9999 59.9996C31.9684 59.9996 33.5643 56.808 33.5643 52.8709C33.5643 48.9338 31.9684 45.7422 29.9999 45.7422C28.0314 45.7422 26.4355 48.9338 26.4355 52.8709C26.4355 56.808 28.0314 59.9996 29.9999 59.9996Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[4]}",
                    path {
                        d: "M45.1426 55.8992C46.8411 54.9042 46.605 51.3437 44.615 47.9465C42.6251 44.5493 39.635 42.6019 37.9364 43.5969C36.2378 44.5919 36.474 48.1524 38.4639 51.5496C40.4538 54.9467 43.444 56.8941 45.1426 55.8992Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[3]}",
                    path {
                        d: "M55.8948 45.1384C56.8898 43.4398 54.9424 40.4497 51.5452 38.4598C48.148 36.4698 44.5875 36.2337 43.5926 37.9322C42.5976 39.6308 44.545 42.621 47.9421 44.6109C51.3393 46.6008 54.8998 46.837 55.8948 45.1384Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[2]}",
                    path {
                        d: "M52.8714 33.5662C56.8085 33.5662 60.0001 31.9704 60.0001 30.0019C60.0001 28.0333 56.8085 26.4375 52.8714 26.4375C48.9343 26.4375 45.7427 28.0333 45.7427 30.0019C45.7427 31.9704 48.9343 33.5662 52.8714 33.5662Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[1]}",
                    path {
                        d: "M51.5482 21.5324C54.9453 19.5425 56.8927 16.5524 55.8977 14.8538C54.9028 13.1552 51.3422 13.3914 47.9451 15.3813C44.5479 17.3712 42.6005 20.3614 43.5955 22.0599C44.5904 23.7585 48.151 23.5224 51.5482 21.5324Z",
                        fill: "#85E3CB",
                    }
                }
                g { opacity: "{ops()[0]}",
                    path {
                        d: "M44.617 12.0613C46.6069 8.66415 46.8431 5.10362 45.1445 4.10865C43.4459 3.11369 40.4558 5.06107 38.4659 8.45825C36.4759 11.8554 36.2398 15.416 37.9384 16.4109C39.6369 17.4059 42.6271 15.4585 44.617 12.0613Z",
                        fill: "#85E3CB",
                    }
                }
            }
            defs {
                clipPath { id: "clip0_204_7856",
                    rect { fill: "white", height: "60", width: "60" }
                }
            }
        }
    }
}
